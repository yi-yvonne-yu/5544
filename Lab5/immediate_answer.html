<!DOCTYPE html>
<meta charset="utf-8">
<title>Life Expectancy by Region Over Time</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; }
  h1 { margin: 0 0 12px; font-size: 20px; }
  #chart { max-width: 960px; }
  .axis path, .axis line { fill: none; stroke: #000; shape-rendering: crispEdges; }
  .grid line { stroke: #eee; }
  .legend { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
  .legend-item { display: inline-flex; align-items: center; gap: 6px; cursor: pointer; user-select: none; }
  .legend-swatch { width: 12px; height: 12px; border-radius: 2px; background: #ccc; }
  .legend-item.inactive { opacity: 0.35; }
  .tooltip {
    position: absolute; pointer-events: none; background: white; border: 1px solid #ddd;
    border-radius: 6px; padding: 6px 8px; font-size: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .annotation { font-size: 12px; fill: #444; }
</style>
<h1>Is there a correlation between life expectancy and region over the years?</h1>
<div id="chart"></div>
<div class="legend" id="legend"></div>
<p class="annotation">Each line shows the average life expectancy for a region by year. Consistently higher (or lower) lines indicate systematic regional differences over time.</p>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script>
const series = [{"region": "East Asia & Pacific", "values": [{"year": 1960, "life_expectancy": 53.03953658536585}, {"year": 1961, "life_expectancy": 54.37793728222997}, {"year": 1962, "life_expectancy": 56.30151219512196}, {"year": 1963, "life_expectancy": 56.682857142857145}, {"year": 1964, "life_expectancy": 57.08052264808362}, {"year": 1965, "life_expectancy": 57.48734843205575}, {"year": 1966, "life_expectancy": 57.81025783972126}, {"year": 1967, "life_expectancy": 58.94258885017423}, {"year": 1968, "life_expectancy": 59.33629268292683}, {"year": 1969, "life_expectancy": 59.79098257839722}, {"year": 1970, "life_expectancy": 60.28431010452962}, {"year": 1971, "life_expectancy": 60.74948780487805}, {"year": 1972, "life_expectancy": 61.17918815331011}, {"year": 1973, "life_expectancy": 61.67039721254356}, {"year": 1974, "life_expectancy": 62.12891289198607}, {"year": 1975, "life_expectancy": 62.594881533101045}, {"year": 1976, "life_expectancy": 62.96921254355401}, {"year": 1977, "life_expectancy": 63.487445993031365}, {"year": 1978, "life_expectancy": 63.90716027874565}, {"year": 1979, "life_expectancy": 64.38258536585366}, {"year": 1980, "life_expectancy": 64.87208362369338}, {"year": 1981, "life_expectancy": 65.32859233449479}, {"year": 1982, "life_expectancy": 65.7314181184669}, {"year": 1983, "life_expectancy": 66.14527526132404}, {"year": 1984, "life_expectancy": 66.56448083623694}, {"year": 1985, "life_expectancy": 66.96848083623694}, {"year": 1986, "life_expectancy": 67.38495470383275}, {"year": 1987, "life_expectancy": 67.6107630662021}, {"year": 1988, "life_expectancy": 68.02819163763067}, {"year": 1989, "life_expectancy": 68.27887456445993}, {"year": 1990, "life_expectancy": 68.59795470383276}, {"year": 1991, "life_expectancy": 68.90752613240419}, {"year": 1992, "life_expectancy": 69.21541463414634}, {"year": 1993, "life_expectancy": 69.50227177700349}, {"year": 1994, "life_expectancy": 69.7823031358885}, {"year": 1995, "life_expectancy": 70.06787456445993}, {"year": 1996, "life_expectancy": 70.39690592334496}, {"year": 1997, "life_expectancy": 70.73400000000001}, {"year": 1998, "life_expectancy": 71.04126829268293}, {"year": 1999, "life_expectancy": 71.29456794425087}, {"year": 2000, "life_expectancy": 71.65099651567945}, {"year": 2001, "life_expectancy": 71.9873449477352}, {"year": 2002, "life_expectancy": 72.23643902439025}, {"year": 2003, "life_expectancy": 72.5262369337979}, {"year": 2004, "life_expectancy": 72.79387108013937}, {"year": 2005, "life_expectancy": 73.09879094076655}, {"year": 2006, "life_expectancy": 73.3256794425087}, {"year": 2007, "life_expectancy": 73.5991393728223}, {"year": 2008, "life_expectancy": 73.84161672473867}, {"year": 2009, "life_expectancy": 74.17153658536586}, {"year": 2010, "life_expectancy": 74.41179094076655}, {"year": 2011, "life_expectancy": 74.66331358885019}, {"year": 2012, "life_expectancy": 74.8923763066202}, {"year": 2013, "life_expectancy": 75.11786759581881}, {"year": 2014, "life_expectancy": 75.32815331010454}, {"year": 2015, "life_expectancy": 75.51532752613241}, {"year": 2016, "life_expectancy": 75.6872787456446}, {"year": 2017, "life_expectancy": 75.84613588850175}, {"year": 2018, "life_expectancy": 76.01477003484321}, {"year": 2019, "life_expectancy": 76.25270731707317}, {"year": 2020, "life_expectancy": 75.98710452961673}, {"year": 2021, "life_expectancy": 75.46335888501743}, {"year": 2022, "life_expectancy": 76.36937282229965}, {"year": 2023, "life_expectancy": 76.57691289198605}]}, {"region": "Europe & Central Asia", "values": [{"year": 1960, "life_expectancy": 66.1190022172949}, {"year": 1961, "life_expectancy": 66.43870509977828}, {"year": 1962, "life_expectancy": 66.51613747228383}, {"year": 1963, "life_expectancy": 66.84757649667407}, {"year": 1964, "life_expectancy": 67.2739268292683}, {"year": 1965, "life_expectancy": 67.4869423503326}, {"year": 1966, "life_expectancy": 67.75246784922396}, {"year": 1967, "life_expectancy": 68.19658758314857}, {"year": 1968, "life_expectancy": 68.29082261640798}, {"year": 1969, "life_expectancy": 68.28011529933481}, {"year": 1970, "life_expectancy": 68.36725720620844}, {"year": 1971, "life_expectancy": 68.6579467849224}, {"year": 1972, "life_expectancy": 68.89892904656321}, {"year": 1973, "life_expectancy": 69.1139600886918}, {"year": 1974, "life_expectancy": 69.30073392461198}, {"year": 1975, "life_expectancy": 69.48214190687362}, {"year": 1976, "life_expectancy": 69.52547450110866}, {"year": 1977, "life_expectancy": 69.76044124168514}, {"year": 1978, "life_expectancy": 69.76743902439024}, {"year": 1979, "life_expectancy": 69.80183592017738}, {"year": 1980, "life_expectancy": 69.89676274944568}, {"year": 1981, "life_expectancy": 70.01053658536586}, {"year": 1982, "life_expectancy": 70.292933481153}, {"year": 1983, "life_expectancy": 70.30877605321508}, {"year": 1984, "life_expectancy": 70.37958536585367}, {"year": 1985, "life_expectancy": 70.75337250554324}, {"year": 1986, "life_expectancy": 71.23473835920178}, {"year": 1987, "life_expectancy": 71.36778048780488}, {"year": 1988, "life_expectancy": 71.58764966740577}, {"year": 1989, "life_expectancy": 71.68045454545455}, {"year": 1990, "life_expectancy": 71.72145454545455}, {"year": 1991, "life_expectancy": 71.8248536585366}, {"year": 1992, "life_expectancy": 71.31183370288248}, {"year": 1993, "life_expectancy": 70.97162084257207}, {"year": 1994, "life_expectancy": 71.53338359201774}, {"year": 1995, "life_expectancy": 71.72463414634147}, {"year": 1996, "life_expectancy": 71.96734368070953}, {"year": 1997, "life_expectancy": 72.18045454545455}, {"year": 1998, "life_expectancy": 72.39447893569846}, {"year": 1999, "life_expectancy": 72.22870066518848}, {"year": 2000, "life_expectancy": 72.64786474501109}, {"year": 2001, "life_expectancy": 72.8789090909091}, {"year": 2002, "life_expectancy": 73.03244124168515}, {"year": 2003, "life_expectancy": 73.32214190687363}, {"year": 2004, "life_expectancy": 73.8139578713969}, {"year": 2005, "life_expectancy": 73.9920133037694}, {"year": 2006, "life_expectancy": 74.41665410199558}, {"year": 2007, "life_expectancy": 74.85143237250556}, {"year": 2008, "life_expectancy": 75.3110243902439}, {"year": 2009, "life_expectancy": 75.49558093126387}, {"year": 2010, "life_expectancy": 75.7889889135255}, {"year": 2011, "life_expectancy": 76.11237472283814}, {"year": 2012, "life_expectancy": 76.44353436807096}, {"year": 2013, "life_expectancy": 76.71322394678492}, {"year": 2014, "life_expectancy": 77.0269534368071}, {"year": 2015, "life_expectancy": 77.13849889135255}, {"year": 2016, "life_expectancy": 77.42976718403548}, {"year": 2017, "life_expectancy": 77.59909977827051}, {"year": 2018, "life_expectancy": 77.8590354767184}, {"year": 2019, "life_expectancy": 77.9918603104213}, {"year": 2020, "life_expectancy": 76.84337028824835}, {"year": 2021, "life_expectancy": 76.288022172949}, {"year": 2022, "life_expectancy": 77.76159423503327}, {"year": 2023, "life_expectancy": 78.41531485587585}]}, {"region": "Latin America & Caribbean", "values": [{"year": 1960, "life_expectancy": 58.946250000000006}, {"year": 1961, "life_expectancy": 59.5395}, {"year": 1962, "life_expectancy": 60.01875}, {"year": 1963, "life_expectancy": 60.44}, {"year": 1964, "life_expectancy": 60.97675}, {"year": 1965, "life_expectancy": 61.525875}, {"year": 1966, "life_expectancy": 62.070625}, {"year": 1967, "life_expectancy": 62.54475}, {"year": 1968, "life_expectancy": 62.882625}, {"year": 1969, "life_expectancy": 63.15525}, {"year": 1970, "life_expectancy": 62.36075}, {"year": 1971, "life_expectancy": 63.726375}, {"year": 1972, "life_expectancy": 63.287125}, {"year": 1973, "life_expectancy": 64.428125}, {"year": 1974, "life_expectancy": 64.83200000000001}, {"year": 1975, "life_expectancy": 65.22562500000001}, {"year": 1976, "life_expectancy": 65.549875}, {"year": 1977, "life_expectancy": 65.83625}, {"year": 1978, "life_expectancy": 65.80137500000001}, {"year": 1979, "life_expectancy": 65.70575}, {"year": 1980, "life_expectancy": 66.902}, {"year": 1981, "life_expectancy": 67.26962499999999}, {"year": 1982, "life_expectancy": 67.638125}, {"year": 1983, "life_expectancy": 67.049125}, {"year": 1984, "life_expectancy": 67.721875}, {"year": 1985, "life_expectancy": 67.981375}, {"year": 1986, "life_expectancy": 68.3845}, {"year": 1987, "life_expectancy": 68.5415}, {"year": 1988, "life_expectancy": 69.06225}, {"year": 1989, "life_expectancy": 69.49125}, {"year": 1990, "life_expectancy": 69.838}, {"year": 1991, "life_expectancy": 70.124625}, {"year": 1992, "life_expectancy": 70.405125}, {"year": 1993, "life_expectancy": 70.678375}, {"year": 1994, "life_expectancy": 70.99725000000001}, {"year": 1995, "life_expectancy": 71.33675}, {"year": 1996, "life_expectancy": 71.67925}, {"year": 1997, "life_expectancy": 71.92}, {"year": 1998, "life_expectancy": 71.983}, {"year": 1999, "life_expectancy": 72.440125}, {"year": 2000, "life_expectancy": 72.70575}, {"year": 2001, "life_expectancy": 73.030375}, {"year": 2002, "life_expectancy": 73.318625}, {"year": 2003, "life_expectancy": 73.645625}, {"year": 2004, "life_expectancy": 73.754375}, {"year": 2005, "life_expectancy": 74.198375}, {"year": 2006, "life_expectancy": 74.382375}, {"year": 2007, "life_expectancy": 74.59425}, {"year": 2008, "life_expectancy": 74.68124999999999}, {"year": 2009, "life_expectancy": 74.78025}, {"year": 2010, "life_expectancy": 74.93}, {"year": 2011, "life_expectancy": 75.096125}, {"year": 2012, "life_expectancy": 75.31575000000001}, {"year": 2013, "life_expectancy": 75.46525}, {"year": 2014, "life_expectancy": 75.621625}, {"year": 2015, "life_expectancy": 75.71775}, {"year": 2016, "life_expectancy": 75.778875}, {"year": 2017, "life_expectancy": 75.67625}, {"year": 2018, "life_expectancy": 75.90174999999999}, {"year": 2019, "life_expectancy": 75.9745}, {"year": 2020, "life_expectancy": 74.924375}, {"year": 2021, "life_expectancy": 73.35725}, {"year": 2022, "life_expectancy": 75.921375}, {"year": 2023, "life_expectancy": 76.57975}]}, {"region": "Middle East, North Africa, Afghanistan & Pakistan", "values": [{"year": 1960, "life_expectancy": 46.0335}, {"year": 1961, "life_expectancy": 42.86425}, {"year": 1962, "life_expectancy": 43.03575}, {"year": 1963, "life_expectancy": 48.1745}, {"year": 1964, "life_expectancy": 48.6325}, {"year": 1965, "life_expectancy": 49.078}, {"year": 1966, "life_expectancy": 45.64625}, {"year": 1967, "life_expectancy": 46.2105}, {"year": 1968, "life_expectancy": 46.6855}, {"year": 1969, "life_expectancy": 47.16525}, {"year": 1970, "life_expectancy": 47.328}, {"year": 1971, "life_expectancy": 48.16375}, {"year": 1972, "life_expectancy": 48.7475}, {"year": 1973, "life_expectancy": 49.3345}, {"year": 1974, "life_expectancy": 49.94875}, {"year": 1975, "life_expectancy": 50.60475}, {"year": 1976, "life_expectancy": 51.3135}, {"year": 1977, "life_expectancy": 52.06225}, {"year": 1978, "life_expectancy": 52.46425}, {"year": 1979, "life_expectancy": 52.9195}, {"year": 1980, "life_expectancy": 53.8705}, {"year": 1981, "life_expectancy": 54.94275}, {"year": 1982, "life_expectancy": 54.97025}, {"year": 1983, "life_expectancy": 55.807750000000006}, {"year": 1984, "life_expectancy": 55.20975}, {"year": 1985, "life_expectancy": 56.0205}, {"year": 1986, "life_expectancy": 58.1465}, {"year": 1987, "life_expectancy": 58.7195}, {"year": 1988, "life_expectancy": 60.246}, {"year": 1989, "life_expectancy": 60.9115}, {"year": 1990, "life_expectancy": 62.089286585365855}, {"year": 1991, "life_expectancy": 62.38306097560976}, {"year": 1992, "life_expectancy": 63.23859756097562}, {"year": 1993, "life_expectancy": 64.43087195121952}, {"year": 1994, "life_expectancy": 64.48420731707317}, {"year": 1995, "life_expectancy": 64.81768902439025}, {"year": 1996, "life_expectancy": 65.08151219512195}, {"year": 1997, "life_expectancy": 65.26653658536586}, {"year": 1998, "life_expectancy": 65.27657317073172}, {"year": 1999, "life_expectancy": 65.97173780487805}, {"year": 2000, "life_expectancy": 66.26496951219512}, {"year": 2001, "life_expectancy": 66.56933536585366}, {"year": 2002, "life_expectancy": 66.91790853658537}, {"year": 2003, "life_expectancy": 67.30864024390243}, {"year": 2004, "life_expectancy": 67.60567073170732}, {"year": 2005, "life_expectancy": 67.61019512195122}, {"year": 2006, "life_expectancy": 68.07242073170733}, {"year": 2007, "life_expectancy": 68.29504268292683}, {"year": 2008, "life_expectancy": 68.61551219512195}, {"year": 2009, "life_expectancy": 68.89859146341463}, {"year": 2010, "life_expectancy": 69.15080487804877}, {"year": 2011, "life_expectancy": 69.47256097560975}, {"year": 2012, "life_expectancy": 69.77500609756098}, {"year": 2013, "life_expectancy": 70.0852012195122}, {"year": 2014, "life_expectancy": 70.33008536585365}, {"year": 2015, "life_expectancy": 70.58689024390245}, {"year": 2016, "life_expectancy": 70.95414634146341}, {"year": 2017, "life_expectancy": 71.15401829268293}, {"year": 2018, "life_expectancy": 71.38034146341464}, {"year": 2019, "life_expectancy": 72.12618902439024}, {"year": 2020, "life_expectancy": 70.37474390243902}, {"year": 2021, "life_expectancy": 69.78264634146342}, {"year": 2022, "life_expectancy": 72.67745121951219}, {"year": 2023, "life_expectancy": 73.67145121951219}]}, {"region": "North America", "values": [{"year": 1960, "life_expectancy": 66.482}, {"year": 1961, "life_expectancy": 67.528}, {"year": 1962, "life_expectancy": 67.884}, {"year": 1963, "life_expectancy": 67.689}, {"year": 1964, "life_expectancy": 67.5}, {"year": 1965, "life_expectancy": 67.582}, {"year": 1966, "life_expectancy": 67.718}, {"year": 1967, "life_expectancy": 67.792}, {"year": 1968, "life_expectancy": 67.898}, {"year": 1969, "life_expectancy": 68.088}, {"year": 1970, "life_expectancy": 68.404}, {"year": 1971, "life_expectancy": 68.98}, {"year": 1972, "life_expectancy": 69.643}, {"year": 1973, "life_expectancy": 70.374}, {"year": 1974, "life_expectancy": 70.864}, {"year": 1975, "life_expectancy": 71.171}, {"year": 1976, "life_expectancy": 71.331}, {"year": 1977, "life_expectancy": 71.616}, {"year": 1978, "life_expectancy": 71.968}, {"year": 1979, "life_expectancy": 72.402}, {"year": 1980, "life_expectancy": 72.666}, {"year": 1981, "life_expectancy": 72.892}, {"year": 1982, "life_expectancy": 73.041}, {"year": 1983, "life_expectancy": 73.24}, {"year": 1984, "life_expectancy": 73.365}, {"year": 1985, "life_expectancy": 73.373}, {"year": 1986, "life_expectancy": 73.368}, {"year": 1987, "life_expectancy": 73.454}, {"year": 1988, "life_expectancy": 73.555}, {"year": 1989, "life_expectancy": 73.733}, {"year": 1990, "life_expectancy": 73.952}, {"year": 1991, "life_expectancy": 74.204}, {"year": 1992, "life_expectancy": 74.446}, {"year": 1993, "life_expectancy": 74.766}, {"year": 1994, "life_expectancy": 75.276}, {"year": 1995, "life_expectancy": 75.92}, {"year": 1996, "life_expectancy": 76.52}, {"year": 1997, "life_expectancy": 76.972}, {"year": 1998, "life_expectancy": 77.389}, {"year": 1999, "life_expectancy": 77.854}, {"year": 2000, "life_expectancy": 78.251}, {"year": 2001, "life_expectancy": 78.637}, {"year": 2002, "life_expectancy": 78.841}, {"year": 2003, "life_expectancy": 78.715}, {"year": 2004, "life_expectancy": 78.898}, {"year": 2005, "life_expectancy": 78.874}, {"year": 2006, "life_expectancy": 78.87}, {"year": 2007, "life_expectancy": 79.006}, {"year": 2008, "life_expectancy": 79.101}, {"year": 2009, "life_expectancy": 79.229}, {"year": 2010, "life_expectancy": 79.414}, {"year": 2011, "life_expectancy": 79.651}, {"year": 2012, "life_expectancy": 79.847}, {"year": 2013, "life_expectancy": 80.016}, {"year": 2014, "life_expectancy": 80.199}, {"year": 2015, "life_expectancy": 80.338}, {"year": 2016, "life_expectancy": 80.476}, {"year": 2017, "life_expectancy": 80.686}, {"year": 2018, "life_expectancy": 80.986}, {"year": 2019, "life_expectancy": 81.251}, {"year": 2020, "life_expectancy": 81.456}, {"year": 2021, "life_expectancy": 81.745}, {"year": 2022, "life_expectancy": 82.062}, {"year": 2023, "life_expectancy": 82.309}]}, {"region": "South Asia", "values": [{"year": 1960, "life_expectancy": 43.98}, {"year": 1961, "life_expectancy": 44.887}, {"year": 1962, "life_expectancy": 45.765}, {"year": 1963, "life_expectancy": 45.722}, {"year": 1964, "life_expectancy": 46.752}, {"year": 1965, "life_expectancy": 46.046}, {"year": 1966, "life_expectancy": 47.644}, {"year": 1967, "life_expectancy": 48.066}, {"year": 1968, "life_expectancy": 48.4}, {"year": 1969, "life_expectancy": 48.686}, {"year": 1970, "life_expectancy": 42.667}, {"year": 1971, "life_expectancy": 26.522}, {"year": 1972, "life_expectancy": 49.647}, {"year": 1973, "life_expectancy": 49.914}, {"year": 1974, "life_expectancy": 49.589}, {"year": 1975, "life_expectancy": 50.627}, {"year": 1976, "life_expectancy": 50.951}, {"year": 1977, "life_expectancy": 51.265}, {"year": 1978, "life_expectancy": 51.596}, {"year": 1979, "life_expectancy": 51.959}, {"year": 1980, "life_expectancy": 52.278}, {"year": 1981, "life_expectancy": 52.638}, {"year": 1982, "life_expectancy": 53.012}, {"year": 1983, "life_expectancy": 53.441}, {"year": 1984, "life_expectancy": 53.826}, {"year": 1985, "life_expectancy": 53.937}, {"year": 1986, "life_expectancy": 54.592}, {"year": 1987, "life_expectancy": 54.899}, {"year": 1988, "life_expectancy": 55.174}, {"year": 1989, "life_expectancy": 55.514}, {"year": 1990, "life_expectancy": 55.822}, {"year": 1991, "life_expectancy": 53.781}, {"year": 1992, "life_expectancy": 56.592}, {"year": 1993, "life_expectancy": 57.073}, {"year": 1994, "life_expectancy": 57.64}, {"year": 1995, "life_expectancy": 58.244}, {"year": 1996, "life_expectancy": 58.94}, {"year": 1997, "life_expectancy": 59.671}, {"year": 1998, "life_expectancy": 60.429}, {"year": 1999, "life_expectancy": 61.244}, {"year": 2000, "life_expectancy": 62.049}, {"year": 2001, "life_expectancy": 62.836}, {"year": 2002, "life_expectancy": 63.591}, {"year": 2003, "life_expectancy": 64.288}, {"year": 2004, "life_expectancy": 64.912}, {"year": 2005, "life_expectancy": 65.509}, {"year": 2006, "life_expectancy": 66.048}, {"year": 2007, "life_expectancy": 66.458}, {"year": 2008, "life_expectancy": 67.047}, {"year": 2009, "life_expectancy": 67.527}, {"year": 2010, "life_expectancy": 68.009}, {"year": 2011, "life_expectancy": 68.499}, {"year": 2012, "life_expectancy": 68.989}, {"year": 2013, "life_expectancy": 69.487}, {"year": 2014, "life_expectancy": 70.016}, {"year": 2015, "life_expectancy": 70.543}, {"year": 2016, "life_expectancy": 71.075}, {"year": 2017, "life_expectancy": 71.606}, {"year": 2018, "life_expectancy": 72.122}, {"year": 2019, "life_expectancy": 72.625}, {"year": 2020, "life_expectancy": 71.421}, {"year": 2021, "life_expectancy": 71.103}, {"year": 2022, "life_expectancy": 74.265}, {"year": 2023, "life_expectancy": 74.672}]}, {"region": "Sub-Saharan Africa", "values": [{"year": 1960, "life_expectancy": 42.96315989159891}, {"year": 1961, "life_expectancy": 43.21101355013551}, {"year": 1962, "life_expectancy": 43.485032520325205}, {"year": 1963, "life_expectancy": 43.75219512195122}, {"year": 1964, "life_expectancy": 44.0059349593496}, {"year": 1965, "life_expectancy": 44.06689972899729}, {"year": 1966, "life_expectancy": 44.50122222222223}, {"year": 1967, "life_expectancy": 44.73849593495935}, {"year": 1968, "life_expectancy": 45.05943902439024}, {"year": 1969, "life_expectancy": 45.35190243902439}, {"year": 1970, "life_expectancy": 45.74658265582656}, {"year": 1971, "life_expectancy": 46.13040108401084}, {"year": 1972, "life_expectancy": 44.68037669376694}, {"year": 1973, "life_expectancy": 46.446338753387536}, {"year": 1974, "life_expectancy": 47.60954200542005}, {"year": 1975, "life_expectancy": 48.1389132791328}, {"year": 1976, "life_expectancy": 48.67985636856369}, {"year": 1977, "life_expectancy": 49.22024661246613}, {"year": 1978, "life_expectancy": 49.7700081300813}, {"year": 1979, "life_expectancy": 50.27939837398375}, {"year": 1980, "life_expectancy": 50.86028455284553}, {"year": 1981, "life_expectancy": 51.32220054200542}, {"year": 1982, "life_expectancy": 51.540932249322495}, {"year": 1983, "life_expectancy": 51.97965853658536}, {"year": 1984, "life_expectancy": 52.11051761517615}, {"year": 1985, "life_expectancy": 52.205173441734416}, {"year": 1986, "life_expectancy": 52.26478861788618}, {"year": 1987, "life_expectancy": 52.27906504065041}, {"year": 1988, "life_expectancy": 51.94771544715447}, {"year": 1989, "life_expectancy": 52.25874796747968}, {"year": 1990, "life_expectancy": 51.57436856368564}, {"year": 1991, "life_expectancy": 52.50435501355014}, {"year": 1992, "life_expectancy": 52.54207046070461}, {"year": 1993, "life_expectancy": 51.479032520325205}, {"year": 1994, "life_expectancy": 52.32936314363144}, {"year": 1995, "life_expectancy": 52.74710298102981}, {"year": 1996, "life_expectancy": 52.73133062330624}, {"year": 1997, "life_expectancy": 53.22713279132792}, {"year": 1998, "life_expectancy": 53.57192682926829}, {"year": 1999, "life_expectancy": 54.05825474254743}, {"year": 2000, "life_expectancy": 54.46289430894309}, {"year": 2001, "life_expectancy": 54.94362872628727}, {"year": 2002, "life_expectancy": 55.1129783197832}, {"year": 2003, "life_expectancy": 55.32614092140922}, {"year": 2004, "life_expectancy": 56.35633062330624}, {"year": 2005, "life_expectancy": 56.87441192411925}, {"year": 2006, "life_expectancy": 57.469230352303526}, {"year": 2007, "life_expectancy": 58.16754471544716}, {"year": 2008, "life_expectancy": 58.77293495934959}, {"year": 2009, "life_expectancy": 59.3879918699187}, {"year": 2010, "life_expectancy": 60.00172899728997}, {"year": 2011, "life_expectancy": 60.561043360433615}, {"year": 2012, "life_expectancy": 61.30173441734418}, {"year": 2013, "life_expectancy": 61.64316802168022}, {"year": 2014, "life_expectancy": 62.05425203252033}, {"year": 2015, "life_expectancy": 62.58479132791328}, {"year": 2016, "life_expectancy": 63.16886178861788}, {"year": 2017, "life_expectancy": 63.603}, {"year": 2018, "life_expectancy": 63.79227371273713}, {"year": 2019, "life_expectancy": 64.27526016260163}, {"year": 2020, "life_expectancy": 64.61295392953929}, {"year": 2021, "life_expectancy": 63.69772899728997}, {"year": 2022, "life_expectancy": 64.85904878048781}, {"year": 2023, "life_expectancy": 65.46005962059621}]}]; // injected data

// Flatten for extent calculations
const flat = series.flatMap(s => s.values);

// Dimensions
const margin = {top: 24, right: 24, bottom: 40, left: 52};
const width = 960;
const height = 520;

// Scales
const x = d3.scaleLinear()
  .domain(d3.extent(flat, d => d.year))
  .range([margin.left, width - margin.right]);

const y = d3.scaleLinear()
  .domain([Math.floor(d3.min(flat, d => d.life_expectancy) - 2), Math.ceil(d3.max(flat, d => d.life_expectancy) + 2)])
  .nice()
  .range([height - margin.bottom, margin.top]);

const color = d3.scaleOrdinal(d3.schemeTableau10)
  .domain(series.map(s => s.region));

// Line generator
const line = d3.line()
  .x(d => x(d.year))
  .y(d => y(d.life_expectancy));

// SVG
const svg = d3.select("#chart").append("svg")
  .attr("viewBox", [0, 0, width, height])
  .attr("width", width)
  .attr("height", height);

// Gridlines
svg.append("g")
  .attr("class", "grid")
  .attr("transform", `translate(0,${height - margin.bottom})`)
  .call(d3.axisBottom(x).tickSize(-(height - margin.top - margin.bottom)).tickFormat(""))
  .selectAll(".tick line").attr("stroke","#f2f2f2");

svg.append("g")
  .attr("class", "grid")
  .attr("transform", `translate(${margin.left},0)`)
  .call(d3.axisLeft(y).tickSize(-(width - margin.left - margin.right)).tickFormat(""))
  .selectAll(".tick line").attr("stroke","#f2f2f2");

// Axes
svg.append("g")
  .attr("class", "axis")
  .attr("transform", `translate(0,${height - margin.bottom})`)
  .call(d3.axisBottom(x).ticks(10).tickFormat(d3.format("d")));
svg.append("g")
  .attr("class", "axis")
  .attr("transform", `translate(${margin.left},0)`)
  .call(d3.axisLeft(y));

// Tooltip
const tooltip = d3.select("body").append("div").attr("class", "tooltip").style("display","none");

// Lines group
const g = svg.append("g");

// Draw lines
const regionGroups = g.selectAll(".region")
  .data(series)
  .join("g")
  .attr("class", "region");

regionGroups.append("path")
  .attr("fill","none")
  .attr("stroke", d => color(d.region))
  .attr("stroke-width", 2)
  .attr("d", d => line(d.values));

// Hover points
regionGroups.selectAll("circle")
  .data(d => d.values.map(v => ({...v, region: d.region})))
  .join("circle")
  .attr("r", 2.5)
  .attr("cx", d => x(d.year))
  .attr("cy", d => y(d.life_expectancy))
  .attr("fill", d => color(d.region))
  .on("mouseenter", (event, d) => {
    tooltip.style("display","block")
      .html(`<b>${d.region}</b><br>Year: ${d.year}<br>Life expectancy: ${d.life_expectancy.toFixed(1)}`);
  })
  .on("mousemove", (event) => {
    tooltip.style("left", (event.pageX + 12) + "px").style("top", (event.pageY - 24) + "px");
  })
  .on("mouseleave", () => tooltip.style("display","none"));

// Legend with toggle
const legend = d3.select("#legend");
const legendItems = legend.selectAll(".legend-item")
  .data(series.map(s => s.region))
  .join("div")
  .attr("class","legend-item")
  .on("click", function(event, region) {
    const item = d3.select(this);
    const inactive = item.classed("inactive");
    item.classed("inactive", !inactive);

    const visible = inactive; // toggled state
    svg.selectAll(".region").filter(d => d.region === region)
      .style("display", visible ? null : "none");
  });

legendItems.append("div")
  .attr("class","legend-swatch")
  .style("background", r => color(r));

legendItems.append("div").text(r => r);

// Axis labels
svg.append("text")
  .attr("text-anchor", "middle")
  .attr("x", margin.left + (width - margin.left - margin.right) / 2)
  .attr("y", height - 6)
  .text("Year");

svg.append("text")
  .attr("text-anchor", "middle")
  .attr("transform", `translate(16, ${margin.top + (height - margin.top - margin.bottom)/2}) rotate(-90)`)
  .text("Life expectancy (years)");
</script>
